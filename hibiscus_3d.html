<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Hibiscus 3D Bloom</title>
<style>
  body {
    margin: 0;
    padding: 0;
    background: #fafafa;
  }
</style>
</head>
<body>
<div id="hibiscus-container" style="width: 100%; max-width: 600px; height: 500px; margin: 0 auto; position: relative; overflow: hidden; background: linear-gradient(to bottom, #ffffff, #f0f0f0); border-radius: 12px;">
    <div id="hibiscus-loading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-family: sans-serif; color: #888; font-size: 14px;">
        Generating Bloom...
    </div>
</div>

<script type="module">
    import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';

    const container = document.getElementById('hibiscus-container');
    const loading = document.getElementById('hibiscus-loading');

    const scene = new THREE.Scene();
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambientLight);

    const dirLight = new THREE.DirectionalLight(0xffddcc, 0.8);
    dirLight.position.set(5, 10, 7);
    scene.add(dirLight);

    const pointLight = new THREE.PointLight(0xff0055, 0.5);
    pointLight.position.set(0, 2, 0);
    scene.add(pointLight);

    const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 100);
    camera.position.set(0, 2, 6);
    camera.lookAt(0, 0, 0);

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1.2;
    container.appendChild(renderer.domElement);

    function createPetalTexture() {
        const canvas = document.createElement('canvas');
        canvas.width = 512;
        canvas.height = 512;
        const ctx = canvas.getContext('2d');

        const grad = ctx.createRadialGradient(256, 512, 20, 256, 200, 500);
        grad.addColorStop(0, '#5e001f');
        grad.addColorStop(0.3, '#d9004c');
        grad.addColorStop(0.7, '#ff6699');
        grad.addColorStop(1, '#ffdde6');

        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, 512, 512);

        ctx.globalCompositeOperation = 'multiply';
        ctx.strokeStyle = '#990033';
        ctx.lineWidth = 1;
        ctx.beginPath();
        for(let i=0; i<80; i++) {
            const x = Math.random() * 512;
            ctx.moveTo(256, 512);
            ctx.quadraticCurveTo(x + (Math.random()-0.5)*100, 300, x, 0);
            ctx.stroke();
        }

        return new THREE.CanvasTexture(canvas);
    }

    const flowerGroup = new THREE.Group();

    const petalShape = new THREE.Shape();
    petalShape.moveTo(0, 0);
    petalShape.bezierCurveTo(0.5, 0.1, 1.5, 1.5, 0.0, 3.0);
    petalShape.bezierCurveTo(-1.5, 1.5, -0.5, 0.1, 0.0, 0.0);

    const petalGeometry = new THREE.ShapeGeometry(petalShape, 12);
    const pos = petalGeometry.attributes.position;
    for ( let i = 0; i < pos.count; i ++ ) {
        const x = pos.getX(i);
        const y = pos.getY(i);
        const z = Math.pow(y, 1.5) * -0.3 + Math.pow(Math.abs(x), 2) * 0.2;
        pos.setZ(i, z);
    }
    petalGeometry.computeVertexNormals();

    const petalMaterial = new THREE.MeshStandardMaterial({
        map: createPetalTexture(),
        side: THREE.DoubleSide,
        roughness: 0.6,
        metalness: 0.1,
        emissive: 0x330011,
        emissiveIntensity: 0.2
    });

    for (let i = 0; i < 5; i++) {
        const petal = new THREE.Mesh(petalGeometry, petalMaterial);
        petal.rotation.z = (i / 5) * Math.PI * 2;
        petal.rotateX(0.3);
        flowerGroup.add(petal);
    }

    const stamenGroup = new THREE.Group();

    const stalkGeo = new THREE.CylinderGeometry(0.08, 0.15, 2.5, 16);
    const stalkMat = new THREE.MeshStandardMaterial({ color: 0xdd0044, roughness: 0.4 });
    const stalk = new THREE.Mesh(stalkGeo, stalkMat);
    stalk.position.y = 0.5;
    stalk.rotation.x = Math.PI / 2;
    stamenGroup.add(stalk);

    const antherGeo = new THREE.SphereGeometry(0.06, 8, 8);
    const antherMat = new THREE.MeshStandardMaterial({ color: 0xffdd00, emissive: 0xaa8800 });

    for(let i=0; i<20; i++) {
        const anther = new THREE.Mesh(antherGeo, antherMat);
        const angle = Math.random() * Math.PI * 2;
        const radius = 0.1 + Math.random() * 0.1;
        const lengthPos = 1.2 + Math.random() * 0.5;
        anther.position.set(Math.cos(angle)*radius, Math.sin(angle)*radius + 0.5, lengthPos);
        stamenGroup.add(anther);
    }

    for(let i=0; i<5; i++) {
        const tip = new THREE.Mesh(new THREE.SphereGeometry(0.1, 8, 8), new THREE.MeshStandardMaterial({color: 0x880000}));
        const angle = (i/5) * Math.PI * 2;
        tip.position.set(Math.cos(angle)*0.2, Math.sin(angle)*0.2 + 0.5, 1.8);
        stamenGroup.add(tip);
    }

    stamenGroup.rotation.x = -Math.PI / 2 + 0.3;
    flowerGroup.add(stamenGroup);

    scene.add(flowerGroup);

    if(loading) loading.style.display = 'none';

    const clock = new THREE.Clock();

    function animate() {
        requestAnimationFrame(animate);

        const time = clock.getElapsedTime();
        flowerGroup.rotation.y = time * 0.3;
        flowerGroup.position.y = Math.sin(time) * 0.1;
        flowerGroup.rotation.z = Math.cos(time * 0.5) * 0.05;

        renderer.render(scene, camera);
    }

    animate();

    window.addEventListener('resize', () => {
        if (!container) return;
        const width = container.clientWidth;
        const height = container.clientHeight;
        renderer.setSize(width, height);
        camera.aspect = width / height;
        camera.updateProjectionMatrix();
    });
</script>
</body>
</html>
